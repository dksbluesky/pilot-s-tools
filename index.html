<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dennis @ TNN Pilot EFB</title>
    <style>
        :root { --primary: #004e92; --accent: #00c6ff; --danger: #e74c3c; --success: #2ecc71; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f2f5; margin: 0; padding: 10px; color: #333; }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        .header { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 25px; border-radius: 12px; text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        
        /* è¡¨å–®æ¨£å¼ */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: var(--dark); }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        textarea { font-family: monospace; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: 15px; }
        
        /* çµæœå€å¡Š */
        .section-title { border-left: 5px solid var(--primary); padding-left: 10px; margin: 20px 0 15px; color: var(--primary); }
        .metar-box { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9rem; line-height: 1.5; margin-bottom: 15px; }
        
        /* å´é¢¨èˆ‡èˆªç·šè¡¨æ ¼ */
        .display-flex { display: flex; flex-wrap: wrap; gap: 15px; }
        .data-box { flex: 1; min-width: 200px; background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .val { font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #eee; font-size: 0.8rem; }
        .hdg-cell { font-weight: bold; color: #e67e22; font-size: 1.1rem; }
        
        .footer-hint { background: #fff5e6; border-left: 4px solid #f39c12; padding: 12px; font-size: 0.85rem; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Pilot Integrated Dashboard</h1>
        <p>Dennis @ TNN é£›è¡Œå°ˆæ¥­å·¥å…·ç®±</p>
    </div>

    <div class="card">
        <label>1. è¼¸å…¥ METAR åŸå§‹æ–‡æœ¬</label>
        <textarea id="metarInput" rows="3">RCTP 311200Z 04015KT 9999 FEW015 20/15 Q1013 NOSIG RMK A2992</textarea>
        
        <div class="grid" style="margin-top:15px;">
            <div class="input-group">
                <label>2. è½åœ°è·‘é“ (RWY)</label>
                <input type="number" id="rwy" value="05" placeholder="ä¾‹å¦‚ 05">
            </div>
            <div class="input-group">
                <label>3. å·¡èˆª/èˆªç·šç©ºé€Ÿ (TAS)</label>
                <input type="number" id="tas" value="90">
            </div>
        </div>
        <button class="btn" onclick="calculateAll()">åŸ·è¡Œå…¨é¢è¨ˆç®—</button>
    </div>

    <div id="results" style="display:none;">
        <div class="card">
            <h3 class="section-title">METAR æ™ºæ…§è§£ç¢¼</h3>
            <div id="metarText" class="metar-box"></div>
        </div>

        <div class="card">
            <h3 class="section-title">è·‘é“é¢¨åŠ›åˆ†é‡ (Runway Components)</h3>
            <div class="display-flex">
                <div class="data-box">
                    <label>é€†é¢¨ (Headwind)</label>
                    <div id="hwVal" class="val">--</div>
                </div>
                <div class="data-box">
                    <label>å´é¢¨ (Crosswind)</label>
                    <div id="xwVal" class="val">--</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3 class="section-title">äº”é‚Šèˆªç·šä¿®æ­£å»ºè­° (25Â° Bank)</h3>
            <table>
                <thead>
                    <tr><th>èˆªæ®µ (Leg)</th><th>èˆªè·¡ (TRK)</th><th>æ¨™é¡Œ (HDG)</th></tr>
                </thead>
                <tbody id="patternBody"></tbody>
            </table>
            <div id="physicsNote" class="footer-hint"></div>
        </div>
    </div>
</div>

<script>
function calculateAll() {
    const raw = document.getElementById('metarInput').value;
    const rwyNum = parseFloat(document.getElementById('rwy').value);
    const rwyHdg = rwyNum * 10;
    const tas = parseFloat(document.getElementById('tas').value);
    const bank = 25;

    // --- 1. METAR è§£æ ---
    let explanation = [];
    const windMatch = raw.match(/(\d{3})(\d{2,3})KT/);
    let wd = 0, ws = 0;
    if(windMatch) {
        wd = parseInt(windMatch[1]);
        ws = parseInt(windMatch[2]);
        explanation.push(`>> é¢¨å‘: ${wd}Â° / é¢¨é€Ÿ: ${ws} KT`);
    }
    if(raw.includes('+RA')) explanation.push(">> è­¦å‘Š: [ +RA ] ç›®å‰æ­£é­é‡å¼·é™é›¨");
    else if(raw.includes('-RA')) explanation.push(">> æé†’: [ -RA ] ç›®å‰ç‚ºè¼•å¾®é™é›¨");
    if(raw.includes('TS')) explanation.push(">> å±éšª: [ TS ] åµæ¸¬åˆ°é›·é›¨æ´»å‹•");
    const rmkA = raw.match(/A(\d{4})/);
    if(rmkA) explanation.push(`>> æ°£å£“è¨­å®š: ${rmkA[1].substring(0,2)}.${rmkA[1].substring(2,4)} inHg`);
    document.getElementById('metarText').innerText = explanation.join('\n');

    // --- 2. å´é¢¨åˆ†é‡è¨ˆç®— (Wind Components) ---
    const diff = (wd - rwyHdg) * Math.PI / 180;
    const headwind = ws * Math.cos(diff);
    const crosswind = Math.abs(ws * Math.sin(diff));
    
    document.getElementById('hwVal').innerText = Math.round(headwind) + " KT";
    document.getElementById('xwVal').innerText = Math.round(crosswind) + " KT";
    document.getElementById('xwVal').style.color = crosswind > 15 ? '#e74c3c' : '#2ecc71';

    // --- 3. äº”é‚Šèˆªç·šè¨ˆç®— ---
    const legs = [
        { n: "ä¸€é‚Š (Upwind)", t: rwyHdg },
        { n: "äºŒé‚Š (Cross)", t: (rwyHdg - 90 + 360) % 360 },
        { n: "ä¸‰é‚Š (Downwind)", t: (rwyHdg - 180 + 360) % 360 },
        { n: "å››é‚Š (Base)", t: (rwyHdg - 270 + 360) % 360 },
        { n: "äº”é‚Š (Final)", t: rwyHdg }
    ];

    let html = "";
    legs.forEach(l => {
        let alpha = (wd - l.t) * Math.PI / 180;
        let wca = Math.asin((ws / tas) * Math.sin(alpha)) * 180 / Math.PI;
        let hdg = (l.t + wca + 360) % 360;
        html += `<tr><td>${l.n}</td><td>${l.t}Â°</td><td class="hdg-cell">${Math.round(hdg)}Â°</td></tr>`;
    });
    document.getElementById('patternBody').innerHTML = html;

    // --- 4. ç‰©ç†è¨ˆç®— ---
    const v_ms = tas * 0.5144;
    const radius = ((v_ms * v_ms) / (9.8 * Math.tan(bank * Math.PI / 180))) / 1852;
    document.getElementById('physicsNote').innerHTML = `
        <strong>ğŸ‘¨â€âœˆï¸ æ•™å®˜è§€å¯Ÿç­†è¨˜ï¼š</strong><br>
        â€¢ åœ¨ ${tas}KT ä¸‹è½‰å½åŠå¾‘ç‚º <b>${radius.toFixed(2)} NM</b>ã€‚<br>
        â€¢ å»ºè­°äºŒé‚Šé£›è‡³è·é›¢è·‘é“ <b>${(1.2 - radius).toFixed(2)} NM</b> æ™‚å£“å¡åº¦ï¼Œè½‰å®Œå‰›å¥½å°æº–ä¸‰é‚Š 1.2 NMã€‚<br>
        â€¢ å´é¢¨åˆ†é‡ <b>${Math.round(crosswind)} KT</b>ï¼Œè«‹æ³¨æ„è½åœ°æ™‚çš„èŸ¹å½¢ä¿®æ­£ã€‚
    `;

    document.getElementById('results').style.display = 'block';
}
</script>

</body>
</html>
