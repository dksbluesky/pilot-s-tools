<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket METAR Pro - Integrated</title>
    <style>
        :root {
            --bg-color: #0b1426;
            --card-bg: #162235;
            --accent-blue: #3b82f6;
            --vfr-green: #22c55e;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --highlight: #f59e0b;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
        }

        /* Tab å°èˆªåˆ— */
        .tab-bar {
            display: flex; background: #111d2f; border-bottom: 1px solid #1e293b;
            position: sticky; top: 0; z-index: 100;
        }
        .tab-btn {
            flex: 1; padding: 15px; border: none; background: none; color: var(--text-dim);
            font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1rem;
        }
        .tab-btn.active { color: var(--text-main); border-bottom: 3px solid var(--accent-blue); background: #1e293b; }

        /* å…§å®¹å€ */
        .content-area { flex: 1; overflow-y: auto; padding: 15px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* å¡ç‰‡æ¨£å¼ (ä»¿é™„åœ–) */
        .card {
            background: var(--card-bg); border-radius: 16px; padding: 20px;
            margin-bottom: 15px; border: 1px solid #1e293b;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .vfr-badge { background: var(--vfr-green); color: black; padding: 2px 10px; border-radius: 20px; font-weight: 800; font-size: 0.8rem; }
        
        /* æ•¸å€¼æ ¼ç·š */
        .val-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .val-box { background: #0f172a; padding: 15px; border-radius: 12px; text-align: center; }
        .val-label { font-size: 0.75rem; color: var(--text-dim); margin-bottom: 5px; display: block; }
        .val-num { font-size: 1.5rem; font-weight: bold; }

        /* è¼¸å…¥èˆ‡æŒ‰éˆ• */
        input, textarea {
            width: 100%; background: #0f172a; border: 1px solid #1e293b; color: white;
            padding: 12px; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box;
        }
        .primary-btn {
            background: var(--accent-blue); color: white; border: none; padding: 15px;
            width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 5px;
        }
        .sync-btn {
            background: #475569; color: white; border: none; padding: 8px;
            border-radius: 6px; font-size: 0.8rem; cursor: pointer; margin-top: 10px;
        }

        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #1e293b; }
        th { font-size: 0.7rem; color: var(--text-dim); }
        .hdg-text { color: var(--highlight); font-weight: bold; font-size: 1.1rem; }

        .metar-raw { font-family: monospace; color: #cbd5e1; line-height: 1.4; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="tab-bar">
        <button class="tab-btn active" onclick="switchTab('metar-tab')">ğŸ“Š METAR è§€æ¸¬</button>
        <button class="tab-btn" onclick="switchTab('pattern-tab')">ğŸ§­ èˆªç·šè¨ˆç®—</button>
    </div>

    <div class="content-area">
        <div id="metar-tab" class="tab-content active">
            <div class="card">
                <div class="card-header">
                    <h2 id="airport-id" style="margin:0">RCNN - å°å— Tainan</h2>
                    <span class="vfr-badge">VFR</span>
                </div>
                <textarea id="metarInput" rows="3">RCNN 010330Z 36011KT 9999 FEW012 SCT080 25/15 Q1015 NOSIG RMK A2999</textarea>
                <button class="primary-btn" onclick="parseMETAR()">è§£æ METAR</button>
                <button class="sync-btn" onclick="syncToPattern()">â¡ï¸ å‚³é€åˆ°èˆªç·šè¨ˆç®— (Tab 2)</button>
            </div>

            <div class="val-grid">
                <div class="val-box">
                    <span class="val-label">ğŸŒ¬ é¢¨é€Ÿ WIND</span>
                    <div class="val-num" id="wind-val">360Â° / 11 KT</div>
                </div>
                <div class="val-box">
                    <span class="val-label">ğŸ‘ èƒ½è¦‹åº¦ VIS</span>
                    <div class="val-num">10km+</div>
                </div>
                <div class="val-box">
                    <span class="val-label">ğŸŒ¡ æ°£æº« TEMP</span>
                    <div class="val-num" id="temp-val">25Â°C</div>
                </div>
                <div class="val-box">
                    <span class="val-label">â² æ°£å£“ QNH</span>
                    <div class="val-num" id="qnh-val">1015</div>
                </div>
            </div>

            <div class="card" style="margin-top:20px;">
                <span class="val-label">ğŸ“– é›»ç¢¼è§£é‡‹ DECODER</span>
                <div id="decoder-text" style="font-size: 0.9rem; margin-top:10px;">
                    NOSIG: ç„¡é¡¯è‘—è®ŠåŒ–<br>RMK: å‚™è¨»é–‹å§‹
                </div>
            </div>
        </div>

        <div id="pattern-tab" class="tab-content">
            <div class="card">
                <h3 style="margin-top:0">èˆªç·šåƒæ•¸è¨­å®š</h3>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1">
                        <label class="val-label">è½åœ°è·‘é“ (RWY)</label>
                        <input type="number" id="pattern-rwy" value="36">
                    </div>
                    <div style="flex:1">
                        <label class="val-label">èˆªç·šç©ºé€Ÿ (TAS)</label>
                        <input type="number" id="pattern-tas" value="90">
                    </div>
                </div>
                <button class="primary-btn" onclick="calcPattern()">å…¨é¢è¨ˆç®—èˆªç·šä¿®æ­£</button>
            </div>

            <div class="card">
                <span class="val-label">ğŸ§­ äº”é‚Šä¿®æ­£å»ºè­° (25Â° Bank)</span>
                <table>
                    <thead>
                        <tr><th>èˆªæ®µ</th><th>TRK</th><th>HDG</th></tr>
                    </thead>
                    <tbody id="pattern-table">
                        <tr><td colspan="3" style="color:#64748b;">è«‹å…ˆå¾ Tab 1 å‚³é€è³‡æ–™æˆ–æ‰‹å‹•è¼¸å…¥</td></tr>
                    </tbody>
                </table>
                <div id="pattern-note" style="margin-top:15px; font-size:0.85rem; color:var(--highlight);"></div>
            </div>
        </div>
    </div>

    <script>
        // åˆ†é åˆ‡æ›é‚è¼¯
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // è§£æ METAR
        function parseMETAR() {
            const raw = document.getElementById('metarInput').value;
            const windMatch = raw.match(/(\d{3})(\d{2,3})KT/);
            if(windMatch) {
                document.getElementById('wind-val').innerText = `${windMatch[1]}Â° / ${windMatch[2]} KT`;
            }
            const tempMatch = raw.match(/(\d{2})\/(\d{2})/);
            if(tempMatch) document.getElementById('temp-val').innerText = `${tempMatch[1]}Â°C`;
            alert("METAR è§£æå®Œæˆ");
        }

        // ä¸€éµè¤‡è£½/å‚³é€è‡³ Tab 2
        function syncToPattern() {
            const raw = document.getElementById('metarInput').value;
            // ç°¡å–®æå–æ©Ÿå ´é è¨­è·‘é“ (ä¾‹å¦‚ 36)
            const windMatch = raw.match(/(\d{3})\d{2,3}KT/);
            if(windMatch) {
                // è‡ªå‹•å¸¶å…¥æœ€æ¥è¿‘é¢¨å‘çš„è·‘é“ (ç¤ºæ„)
                document.getElementById('pattern-rwy').value = Math.round(windMatch[1]/10);
            }
            switchTab('pattern-tab');
            document.querySelectorAll('.tab-btn')[1].classList.add('active');
            document.querySelectorAll('.tab-btn')[0].classList.remove('active');
            calcPattern();
        }

        // èˆªç·šä¿®æ­£è¨ˆç®—
        function calcPattern() {
            const raw = document.getElementById('metarInput').value;
            const rwy = parseFloat(document.getElementById('pattern-rwy').value) * 10;
            const tas = parseFloat(document.getElementById('pattern-tas').value);
            const windMatch = raw.match(/(\d{3})(\d{2,3})KT/);
            
            if(!windMatch) { alert("è«‹æª¢æŸ¥ Tab 1 çš„ METAR é¢¨åŠ›æ ¼å¼"); return; }
            const wd = parseInt(windMatch[1]);
            const ws = parseInt(windMatch[2]);

            const legs = [
                { n: "ä¸€é‚Š (Upwind)", t: rwy },
                { n: "äºŒé‚Š (Cross)", t: (rwy - 90 + 360) % 360 },
                { n: "ä¸‰é‚Š (Downwind)", t: (rwy - 180 + 360) % 360 },
                { n: "å››é‚Š (Base)", t: (rwy - 270 + 360) % 360 },
                { n: "äº”é‚Š (Final)", t: rwy }
            ];

            let html = "";
            legs.forEach(l => {
                let wca = Math.asin((ws/tas) * Math.sin((wd-l.t)*Math.PI/180)) * 180 / Math.PI;
                html += `<tr><td>${l.n}</td><td>${l.t}Â°</td><td class="hdg-text">${Math.round((l.t+wca+360)%360)}Â°</td></tr>`;
            });
            document.getElementById('pattern-table').innerHTML = html;

            const radius = (Math.pow(tas*0.5144, 2) / (9.8 * Math.tan(25*Math.PI/180))) / 1852;
            document.getElementById('pattern-note').innerHTML = `ğŸ’¡ æ•™å®˜æé†’ï¼šè½‰å½åŠå¾‘ ${radius.toFixed(2)} NMã€‚å»ºè­°åœ¨è·é›¢è·‘é“ä¸­å¿ƒç·š ${(1.2-radius).toFixed(2)} NM è™•é–‹å§‹è½‰å½ã€‚`;
        }
    </script>
</body>
</html>
