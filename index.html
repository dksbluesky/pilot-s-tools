<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pilot Dashboard Pro</title>
    <style>
        :root { --primary: #2563eb; --danger: #dc2626; --bg: #f1f5f9; --card: #ffffff; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        .app-container { max-width: 600px; margin: auto; }
        .card { background: var(--card); border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        h2 { margin-top: 0; color: #1e293b; border-left: 4px solid var(--primary); padding-left: 10px; font-size: 1.25rem; }
        textarea, input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 16px; margin-bottom: 12px; }
        .btn { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: 700; font-size: 1rem; cursor: pointer; }
        .btn:active { opacity: 0.8; }
        .metar-output { background: #0f172a; color: #4ade80; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px; white-space: pre-wrap; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: center; padding: 12px; border-bottom: 1px solid #e2e8f0; }
        .hdg-val { color: #f59e0b; font-weight: 900; font-size: 1.2rem; }
        .note { background: #fffbeb; border-left: 4px solid #f59e0b; padding: 10px; font-size: 0.85rem; color: #92400e; margin-top: 15px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="card">
        <h2>âœˆï¸ é£›è¡Œå“¡ç¶œåˆçœ‹æ¿</h2>
        <label style="font-size:0.8rem; color:#64748b;">è²¼ä¸Š METAR æ–‡å­—</label>
        <textarea id="metarInput" rows="3">RCTP 311200Z 04015KT 9999 FEW015 20/15 Q1013 NOSIG RMK A2992</textarea>
        
        <div style="display:flex; gap:10px;">
            <div style="flex:1">
                <label style="font-size:0.8rem;">ä½¿ç”¨è·‘é“ (RWY)</label>
                <input type="number" id="rwy" value="05">
            </div>
            <div style="flex:1">
                <label style="font-size:0.8rem;">ç©ºé€Ÿ (TAS kt)</label>
                <input type="number" id="tas" value="90">
            </div>
        </div>
        <button class="btn" onclick="processAviation()">è¨ˆç®—èˆªç·šä¿®æ­£ & è§£æ</button>
    </div>

    <div id="results" style="display:none;">
        <div class="card">
            <h2>ğŸ“ METAR æ™ºæ…§è§£æ</h2>
            <div id="metarText" class="metar-output"></div>
        </div>

        <div class="card">
            <h2>ğŸ§­ äº”é‚Šèˆªç·šå»ºè­° (25Â° Bank)</h2>
            <table>
                <thead><tr><th>èˆªæ®µ</th><th>é å®šèˆªè·¡</th><th>ä¿®æ­£æ¨™é¡Œ</th></tr></thead>
                <tbody id="patternBody"></tbody>
            </table>
            <div id="radiusNote" class="note"></div>
        </div>
    </div>
</div>

<script>
function processAviation() {
    const raw = document.getElementById('metarInput').value;
    const rwyHdg = parseFloat(document.getElementById('rwy').value) * 10;
    const tas = parseFloat(document.getElementById('tas').value);
    
    // 1. METAR Parsing
    let info = [];
    const wind = raw.match(/(\d{3})(\d{2,3})KT/);
    let wd = 0, ws = 0;
    if(wind) { wd = parseInt(wind[1]); ws = parseInt(wind[2]); info.push(`ğŸŒ¬ é¢¨å‘: ${wd}Â° / é¢¨é€Ÿ: ${ws}KT`); }
    if(raw.includes('+RA')) info.push("âš ï¸ æ™ºæ…§è§£æ: [ +RA ] å¤§é›¨");
    else if(raw.includes('-RA')) info.push("ğŸŒ¦ æ™ºæ…§è§£æ: [ -RA ] å°é›¨");
    if(raw.includes('TS')) info.push("âš¡ è­¦å ±: [ TS ] æ©Ÿå ´æœ‰é›·é›¨æ´»å‹•");
    const qnh = raw.match(/Q(\d{4})/);
    if(qnh) info.push(`â² æ°£å£“: ${qnh[1]} hPa`);
    const rmk = raw.match(/A(\d{4})/);
    if(rmk) info.push(`ğŸŒ¡ é«˜åº¦è¡¨æ’¥å®šå€¼: ${rmk[1].substring(0,2)}.${rmk[1].substring(2,4)} inHg`);

    document.getElementById('metarText').innerText = info.join('\n');

    // 2. Pattern WCA
    const legs = [
        { n: "ä¸€é‚Š", t: rwyHdg },
        { n: "äºŒé‚Š", t: (rwyHdg - 90 + 360) % 360 },
        { n: "ä¸‰é‚Š", t: (rwyHdg - 180 + 360) % 360 },
        { n: "å››é‚Š", t: (rwyHdg - 270 + 360) % 360 },
        { n: "äº”é‚Š", t: rwyHdg }
    ];
    let html = "";
    legs.forEach(l => {
        let wca = Math.asin((ws/tas) * Math.sin((wd-l.t)*Math.PI/180)) * 180 / Math.PI;
        html += `<tr><td>${l.n}</td><td>${l.t}Â°</td><td class="hdg-val">${Math.round((l.t+wca+360)%360)}Â°</td></tr>`;
    });
    document.getElementById('patternBody').innerHTML = html;

    // 3. Physics
    const radius = ((Math.pow(tas*0.5144, 2)) / (9.8 * Math.tan(25*Math.PI/180))) / 1852;
    document.getElementById('radiusNote').innerHTML = `<b>æ•™å®˜ç­†è¨˜ï¼š</b><br>è½‰å½åŠå¾‘ç´„ <b>${radius.toFixed(2)} NM</b>ã€‚åœ¨äºŒé‚Šé£›è‡³è·é›¢è·‘é“ <b>${(1.2-radius).toFixed(2)} NM</b> æ™‚ï¼Œè«‹å£“ 25Â° å¡åº¦è½‰å…¥ä¸‰é‚Šã€‚`;
    
    document.getElementById('results').style.display = 'block';
}
</script>
</body>
</html>
